<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gum-Gum Cards Inventory</title>
    <link rel="stylesheet" href="./style.css" />
</head>

<body class="inventory-body">
    <div class="inventory-overlay"></div>
    <header class="inventory-header">
      <div class="inventory-header__left">
        <img src="../../images/gengar_strawhat.png" alt="Gum-Gum Logo" class="inventory-logo" />
        <div class="inventory-header__text">
          <h1 class="inventory-title">Gum-Gum Dashboard</h1>
          <p class="inventory-subtitle">Retro-simple controls to watch sealed and unsealed stock in real time.</p>
        </div>
      </div>
      <div class="inventory-header__right">
        <div class="inventory-status">
          <span class="status-indicator"></span>
          <span class="status-copy">Realtime link active</span>
        </div>
        <button type="button" class="ghost-btn" onclick="logout()">Log Out</button>
      </div>
    </header>

    <script>
      if (!localStorage.getItem('isLoggedIn')) {
        window.location.href = '../login/login.html';
      }
      
      function logout() {
        localStorage.removeItem('isLoggedIn');
        window.location.href = '../login/login.html';
      }
    </script>

    <main class="inventory-main">
      <section class="command-strip">
        <div class="command-strip__right">
          <button type="button" id="smartAddBtn" class="primary-btn command-primary">Smart Search</button>
          <button type="button" id="manualAddBtn" class="secondary-btn command-secondary">Manual Entry</button>
          <div class="sync-indicator">
            <span class="sync-dot"></span>
            <span id="lastSynced">Last synced: --</span>
          </div>
        </div>
      </section>

      <section class="stat-panel" aria-live="polite">
        <article class="stat-card">
          <span class="stat-label">Total Unique Cards</span>
          <p id="totalItems" class="stat-number">0</p>
          <span class="stat-caption">Tracked SKUs</span>
        </article>
        <article class="stat-card">
          <span class="stat-label">Total Quantity</span>
          <p id="totalQuantity" class="stat-number">0</p>
          <span class="stat-caption">Cards in stock</span>
        </article>
        <article class="stat-card">
          <span class="stat-label">Inventory Value</span>
          <p id="totalValue" class="stat-number">$0.00</p>
          <span class="stat-caption">Retail estimate</span>
        </article>
      </section>

      <section class="data-frame">
        <header class="data-frame__header">
          <div>
            <h2>Inventory Management</h2>
            <p>Every card recorded in the Gum-Gum vault. Edit inline, check sealed status, and monitor value at a glance.</p>
          </div>
        </header>

        <div class="data-scroll">
          <table>
            <thead>
              <tr>
                <th scope="col">Name &amp; Set</th>
                <th scope="col">Franchise</th>
                <th scope="col">Condition</th>
                <th scope="col">Type</th>
                <th scope="col">Rarity</th>
                <th scope="col">Price</th>
                <th scope="col">Price Paid</th>
                <th scope="col">Stock</th>
                <th scope="col">Last Updated</th>
                <th scope="col">Actions</th>
              </tr>
            </thead>
            <tbody id="cardTableBody">
              <tr>
                <td colspan="10">
                  <div class="table-empty">
                    <p>No cards yet. Click “Add Card” to get started.</p>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
    </main>

    <div class="modal-backdrop" id="modalBackdrop" hidden>
      <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <button type="button" id="closeModalBtn" class="icon-btn" aria-label="Close form">&times;</button>
        <h2 id="modalTitle">Find Cards</h2>
        <p id="modalSubtitle">Search the Pokémon TCG database to add inventory instantly.</p>
        <p class="modal-beta-warning">⚠️ Heads up: this smart search is in beta—Pokémon TCG API responses can take a few seconds to load.</p>

        <div id="modalSearchSection" class="modal-search">
          <form id="intelForm" class="intel-form modal-search__form">
            <label class="intel-field">
              <span class="intel-label">Search Pokémon Card</span>
              <div class="intel-input">
                <input
                  type="text"
                  id="intelSearchInput"
                  placeholder="e.g. Charizard sv49, Umbreon VMAX"
                  autocomplete="off"
                />
                <button type="submit" class="primary-btn intel-submit">Search</button>
              </div>
            </label>
            <div class="modal-search__spinner" id="intelSpinner" aria-hidden="true"></div>
          </form>
          <div class="modal-search__actions">
            <button type="button" class="chip-btn chip-btn--ghost" id="intelClearBtn" hidden>Clear Results</button>
          </div>
          <p class="intel-hint">Tip: Include set codes or numbers (e.g. “Charizard sv49”) to narrow results.</p>
          <div class="intel-history" id="intelHistory" aria-live="polite"></div>
          <div class="intel-results" id="intelResults" aria-live="polite">
            <div class="intel-placeholder">
              Search for a Pokémon card to add it to your inventory.
            </div>
          </div>
        </div>

        <form id="itemForm" class="is-hidden" novalidate>
          <input type="hidden" id="cardId" name="cardId" />

          <div class="form-grid">
            <label>
              <span>Card Name *</span>
              <input type="text" id="cardName" name="name" placeholder="e.g. Umbreon VMAX" required />
            </label>

            <label>
              <span>Franchise *</span>
              <select id="cardFranchise" name="franchise" required>
                <option value="pokemon">Pokemon</option>
                <option value="one piece">One Piece</option>
                <option value="other" selected>Other</option>
              </select>
            </label>

            <label>
              <span>Set / Series</span>
              <input type="text" id="cardSet" name="setName" placeholder="e.g. Evolving Skies" />
            </label>

            <label>
              <span>Type</span>
              <input type="text" id="cardType" name="type" placeholder="e.g. Dark" />
            </label>

            <label>
              <span>Condition *</span>
              <select id="cardCondition" name="condition" required>
                <option value="sealed">Sealed</option>
                <option value="unsealed">Unsealed</option>
              </select>
            </label>

            <label>
              <span>Rarity</span>
              <input type="text" id="cardRarity" name="rarity" placeholder="e.g. Alternate Art Secret Rare" />
            </label>

            <label>
              <span>Price (USD) *</span>
              <input type="number" id="cardPrice" name="price" min="0" step="0.01" placeholder="e.g. 149.99" required />
            </label>

            <label>
              <span>Price Paid (USD)</span>
              <input type="number" id="cardPricePaid" name="pricePaid" min="0" step="0.01" placeholder="e.g. 80.00" />
            </label>

            <label>
              <span>Stock *</span>
              <input type="number" id="cardStock" name="stock" min="0" step="1" placeholder="e.g. 3" required />
            </label>
          </div>

          <label class="notes-field">
            <span>Notes</span>
            <textarea id="cardNotes" name="notes" rows="3" placeholder="Condition, grading, supplier, etc."></textarea>
          </label>

          <div class="modal-actions">
            <button type="button" class="secondary-btn" id="cancelModalBtn">Cancel</button>
            <button type="submit" class="primary-btn" id="submitBtn">Save Card</button>
          </div>
        </form>
      </div>
    </div>

    <div class="status-toast" id="statusToast" role="status" aria-live="polite" hidden></div>

    <footer class="inventory-footnote">
      Built by <a href="https://galaxylabs.net" target="_blank" rel="noopener noreferrer">GalaxyLabs</a>. <a href="https://galaxylabs.net" target="_blank" rel="noopener noreferrer">Click here</a> to contact for more information.
    </footer>

    <script type="module" src="./script.js"></script>
</body>
</html>